"use strict";(self["webpackChunkmy_vue3_cli"]=self["webpackChunkmy_vue3_cli"]||[]).push([[639],{7971:function(e,t,l){l.d(t,{A:function(){return k}});var a=l(6768),r=l(4232),s=l(5130);const d={key:0,"aria-label":"Page navigation example"},n={class:"pagination justify-content-center"},i=["onClick"];function o(e,t,l,o,u,p){return l.pages&&l.pages.total_pages>0?((0,a.uX)(),(0,a.CE)("nav",d,[(0,a.Lk)("ul",n,[(0,a.Lk)("li",{class:(0,r.C4)(["page-item",{disabled:l.pages.current_page<=1}])},[(0,a.Lk)("a",{class:"page-link",href:"#",onClick:t[0]||(t[0]=(0,s.D$)(e=>p.updatePage(l.pages.current_page-1),["prevent"]))}," « ")],2),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(l.pages.total_pages,e=>((0,a.uX)(),(0,a.CE)("li",{class:(0,r.C4)(["page-item",{active:e===l.pages.current_page}]),key:e},[(0,a.Lk)("a",{class:"page-link",href:"#",onClick:(0,s.D$)(t=>p.updatePage(e),["prevent"])},(0,r.v_)(e),9,i)],2))),128)),(0,a.Lk)("li",{class:(0,r.C4)(["page-item",{disabled:l.pages.current_page>=l.pages.total_pages}])},[(0,a.Lk)("a",{class:"page-link",href:"#",onClick:t[1]||(t[1]=(0,s.D$)(e=>p.updatePage(l.pages.current_page+1),["prevent"]))}," » ")],2)])])):(0,a.Q3)("",!0)}var u={name:"MyPagination",props:["pages"],methods:{updatePage(e){this.$emit("emit-pages",e)}}},p=l(1241);const c=(0,p.A)(u,[["render",o]]);var k=c},8639:function(e,t,l){l.r(t),l.d(t,{default:function(){return H}});var a=l(6768),r=l(4232),s=l(5130);const d={class:"table mt-4"},n={key:0},i={key:1},o={class:"list-unstyled"},u={class:"text-right"},p={class:"form-check form-switch"},c=["id","onUpdate:modelValue","onChange"],k=["for"],h={key:0},L={key:1},m={class:"btn-group"},g=["onClick"],b=["onClick"];function v(e,t,l,v,_,y){const C=(0,a.g2)("VueLoading"),f=(0,a.g2)("OrderModal"),O=(0,a.g2)("DelModal"),M=(0,a.g2)("Pagination");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("table",d,[t[1]||(t[1]=(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("th",null,"購買時間"),(0,a.Lk)("th",null,"Email"),(0,a.Lk)("th",null,"購買款項"),(0,a.Lk)("th",null,"應付金額"),(0,a.Lk)("th",null,"是否付款"),(0,a.Lk)("th",null,"編輯")])],-1)),(0,a.bF)(C,{active:_.isLoading,"onUpdate:active":t[0]||(t[0]=e=>_.isLoading=e)},null,8,["active"]),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(_.orders,(t,l)=>((0,a.uX)(),(0,a.CE)(a.FK,{key:l},[_.orders.length?((0,a.uX)(),(0,a.CE)("tr",{key:0,class:(0,r.C4)({"text-secondary":!t.is_paid})},[(0,a.Lk)("td",null,(0,r.v_)(t.create_at?e.$filters.date(t.create_at):"-"),1),(0,a.Lk)("td",null,[t.user?((0,a.uX)(),(0,a.CE)("span",n,(0,r.v_)(t.user.email),1)):((0,a.uX)(),(0,a.CE)("span",i,"-"))]),(0,a.Lk)("td",null,[(0,a.Lk)("ul",o,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.products,(e,t)=>((0,a.uX)(),(0,a.CE)("li",{key:t},(0,r.v_)(e.product.title)+" 數量："+(0,r.v_)(e.qty)+" "+(0,r.v_)(e.product.unit),1))),128))])]),(0,a.Lk)("td",u,(0,r.v_)(t.total??"-"),1),(0,a.Lk)("td",null,[(0,a.Lk)("div",p,[(0,a.bo)((0,a.Lk)("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${t.id}`,"onUpdate:modelValue":e=>t.is_paid=e,onChange:e=>y.updatePaid(t)},null,40,c),[[s.lH,t.is_paid]]),(0,a.Lk)("label",{class:"form-check-label",for:`paidSwitch${t.id}`},[t.is_paid?((0,a.uX)(),(0,a.CE)("span",h,"已付款")):((0,a.uX)(),(0,a.CE)("span",L,"未付款"))],8,k)])]),(0,a.Lk)("td",null,[(0,a.Lk)("div",m,[(0,a.Lk)("button",{class:"btn btn-outline-primary btn-sm",onClick:e=>y.openModal(!1,t)},"檢視",8,g),(0,a.Lk)("button",{class:"btn btn-outline-danger btn-sm",onClick:e=>y.openDelOrderModal(t)},"刪除",8,b)])])],2)):(0,a.Q3)("",!0)],64))),128))])]),(0,a.bF)(f,{order:_.tempOrder,ref:"orderModal",onUpdatePaid:y.updatePaid},null,8,["order","onUpdatePaid"]),(0,a.bF)(O,{item:_.tempOrder,ref:"delModal",onDelItem:y.delOrder},null,8,["item","onDelItem"]),(0,a.bF)(M,{pages:_.pagination,onEmitPages:y.getOrders},null,8,["pages","onEmitPages"])],64)}var _=l(1098);const y={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel",ref:"modal"},C={class:"modal-dialog modal-xl",role:"document"},f={class:"modal-content border-0"},O={class:"modal-header bg-dark text-white"},M={class:"modal-body"},E={class:"row"},P={class:"col-md-4"},X={class:"table"},$={key:0},x={class:"col-md-8"},w={class:"table"},D={key:0},F={key:1},I={key:0,class:"text-success"},A={key:1,class:"text-muted"},K={class:"table"},U={class:"text-end"},S={class:"modal-footer"};function j(e,t,l,s,d,n){return(0,a.uX)(),(0,a.CE)("div",y,[(0,a.Lk)("div",C,[(0,a.Lk)("div",f,[(0,a.Lk)("div",O,[t[3]||(t[3]=(0,a.Lk)("h5",{class:"modal-title",id:"exampleModalLabel"},[(0,a.Lk)("span",null,"訂單細節")],-1)),(0,a.Lk)("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=(...t)=>e.hideModal&&e.hideModal(...t)),"aria-label":"Close"})]),(0,a.Lk)("div",M,[(0,a.Lk)("div",E,[(0,a.Lk)("div",P,[t[8]||(t[8]=(0,a.Lk)("h3",null,"用戶資料",-1)),(0,a.Lk)("table",X,[d.tempOrder.user?((0,a.uX)(),(0,a.CE)("tbody",$,[(0,a.Lk)("tr",null,[t[4]||(t[4]=(0,a.Lk)("th",{style:{width:"100px"}},"姓名",-1)),(0,a.Lk)("td",null,(0,r.v_)(d.tempOrder.user.name),1)]),(0,a.Lk)("tr",null,[t[5]||(t[5]=(0,a.Lk)("th",null,"Email",-1)),(0,a.Lk)("td",null,(0,r.v_)(d.tempOrder.user.email),1)]),(0,a.Lk)("tr",null,[t[6]||(t[6]=(0,a.Lk)("th",null,"電話",-1)),(0,a.Lk)("td",null,(0,r.v_)(d.tempOrder.user.tel),1)]),(0,a.Lk)("tr",null,[t[7]||(t[7]=(0,a.Lk)("th",null,"地址",-1)),(0,a.Lk)("td",null,(0,r.v_)(d.tempOrder.user.address),1)])])):(0,a.Q3)("",!0)])]),(0,a.Lk)("div",x,[t[15]||(t[15]=(0,a.Lk)("h3",null,"訂單細節",-1)),(0,a.Lk)("table",w,[(0,a.Lk)("tbody",null,[(0,a.Lk)("tr",null,[t[9]||(t[9]=(0,a.Lk)("th",{style:{width:"100px"}},"訂單編號",-1)),(0,a.Lk)("td",null,(0,r.v_)(d.tempOrder.id),1)]),(0,a.Lk)("tr",null,[t[10]||(t[10]=(0,a.Lk)("th",null,"下單時間",-1)),(0,a.Lk)("td",null,(0,r.v_)(d.tempOrder.create_at?e.$filters.date(d.tempOrder.create_at):"-"),1)]),(0,a.Lk)("tr",null,[t[11]||(t[11]=(0,a.Lk)("th",null,"付款時間",-1)),(0,a.Lk)("td",null,[d.tempOrder.paid_date?((0,a.uX)(),(0,a.CE)("span",D,(0,r.v_)(e.$filters.date(d.tempOrder.paid_date)),1)):((0,a.uX)(),(0,a.CE)("span",F,"時間不正確"))])]),(0,a.Lk)("tr",null,[t[12]||(t[12]=(0,a.Lk)("th",null,"付款狀態",-1)),(0,a.Lk)("td",null,[d.tempOrder.is_paid?((0,a.uX)(),(0,a.CE)("strong",I,"已付款")):((0,a.uX)(),(0,a.CE)("span",A,"尚未付款"))])]),(0,a.Lk)("tr",null,[t[13]||(t[13]=(0,a.Lk)("th",null,"總金額",-1)),(0,a.Lk)("td",null,(0,r.v_)(d.tempOrder.create_at?n.formatDate(d.tempOrder.create_at):"-"),1)])])]),t[16]||(t[16]=(0,a.Lk)("h3",null,"選購商品",-1)),(0,a.Lk)("table",K,[t[14]||(t[14]=(0,a.Lk)("thead",null,[(0,a.Lk)("tr")],-1)),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(d.tempOrder.products,t=>((0,a.uX)(),(0,a.CE)("tr",{key:t.id},[(0,a.Lk)("th",null,(0,r.v_)(t.product.title),1),(0,a.Lk)("td",null,(0,r.v_)(t.qty)+" / "+(0,r.v_)(t.product.unit),1),(0,a.Lk)("td",U,(0,r.v_)(e.$filters.currency(t.final_total)),1)]))),128))])])])])]),(0,a.Lk)("div",S,[(0,a.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[1]||(t[1]=(...t)=>e.hideModal&&e.hideModal(...t))},"取消 "),(0,a.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[2]||(t[2]=t=>e.$emit("update-order",d.tempOrder))},"確認")])])])],512)}var N={name:"orderModal",props:{order:{type:Object,default(){return{}}}},data(){return{status:{},modal:"",tempOrder:{products:[],user:null},isPaid:!1}},emits:["update-product"],inject:["emitter"],watch:{order(){this.tempOrder={...this.order,products:this.order.products||[],user:this.order.user||null},this.isPaid=this.tempOrder.is_paid}},methods:{formatDate(e){return e?new Date(e).toLocaleString():"-"},formatCurrency(e){return null==e?"-":new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD"}).format(e)}}},Q=l(1241);const V=(0,Q.A)(N,[["render",j]]);var q=V,T=l(7971),W={data(){return{orders:[],isNew:!1,pagination:{},isLoading:!1,tempOrder:{},currentPage:1}},components:{Pagination:T.A,DelModal:_.A,OrderModal:q},methods:{getOrders(e=1){this.currentPage=e;const t=`https://vue3-course-api.hexschool.io/api/yusei-api/admin/orders?page=${e}`;this.isLoading=!0,this.$http.get(t,this.tempProduct).then(e=>{this.orders=e.data.orders,this.pagination=e.data.pagination,this.isLoading=!1,console.log(e)})},openModal(e,t){this.tempOrder={...t},this.isNew=!1;const l=this.$refs.orderModal;l.showModal()},openDelOrderModal(e){this.tempOrder={...e};const t=this.$refs.delModal;t.showModal()},updatePaid(e){this.isLoading=!0;const t=`https://vue3-course-api.hexschool.io/api/yusei-api/admin/order/${e.id}`,l={is_paid:e.is_paid};this.$http.put(t,{data:l}).then(e=>{this.isLoading=!1,this.getOrders(this.currentPage),this.$httpMessageState(e,"更新付款狀態")})},delOrder(){const e=`https://vue3-course-api.hexschool.io/api/yusei-api/admin/order/${this.tempOrder.id}`;this.isLoading=!0,this.$http.delete(e).then(e=>{console.log(e);const t=this.$refs.delModal;t.hideModal(),this.getOrders(this.currentPage)})}},created(){this.getOrders(),console.log("https://vue3-course-api.hexschool.io/")}};const z=(0,Q.A)(W,[["render",v]]);var H=z}}]);
//# sourceMappingURL=639.63e1a332.js.map