"use strict";(self["webpackChunkmy_vue3_cli"]=self["webpackChunkmy_vue3_cli"]||[]).push([[339],{7339:function(e,t,a){a.r(t),a.d(t,{default:function(){return G}});var l=a(6768),r=a(4232),s=a(5130);const n={class:"table mt-4"},d={key:0},o={key:1},i={class:"list-unstyled"},u={class:"text-right"},c={class:"form-check form-switch"},p=["id","onUpdate:modelValue","onChange"],k=["for"],h={key:0},L={key:1},m={class:"btn-group"},g=["onClick"],b=["onClick"];function v(e,t,a,v,y,_){const C=(0,l.g2)("VueLoading"),f=(0,l.g2)("OrderModal"),O=(0,l.g2)("DelModal"),M=(0,l.g2)("Pagination");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("table",n,[t[1]||(t[1]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"購買時間"),(0,l.Lk)("th",null,"Email"),(0,l.Lk)("th",null,"購買款項"),(0,l.Lk)("th",null,"應付金額"),(0,l.Lk)("th",null,"是否付款"),(0,l.Lk)("th",null,"編輯")])],-1)),(0,l.bF)(C,{active:y.isLoading,"onUpdate:active":t[0]||(t[0]=e=>y.isLoading=e)},null,8,["active"]),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(y.orders,(e,t)=>((0,l.uX)(),(0,l.CE)(l.FK,{key:t},[y.orders.length?((0,l.uX)(),(0,l.CE)("tr",{key:0,class:(0,r.C4)({"text-secondary":!e.is_paid})},[(0,l.Lk)("td",null,(0,r.v_)(_.formatDate(e.create_at)),1),(0,l.Lk)("td",null,[e.user?((0,l.uX)(),(0,l.CE)("span",d,(0,r.v_)(e.user.email),1)):((0,l.uX)(),(0,l.CE)("span",o,"-"))]),(0,l.Lk)("td",null,[(0,l.Lk)("ul",i,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.products,(e,t)=>((0,l.uX)(),(0,l.CE)("li",{key:t},(0,r.v_)(e.product.title)+" 數量："+(0,r.v_)(e.qty)+" "+(0,r.v_)(e.product.unit),1))),128))])]),(0,l.Lk)("td",u,(0,r.v_)(e.total??"-"),1),(0,l.Lk)("td",null,[(0,l.Lk)("div",c,[(0,l.bo)((0,l.Lk)("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${e.id}`,"onUpdate:modelValue":t=>e.is_paid=t,onChange:t=>_.updatePaid(e)},null,40,p),[[s.lH,e.is_paid]]),(0,l.Lk)("label",{class:"form-check-label",for:`paidSwitch${e.id}`},[e.is_paid?((0,l.uX)(),(0,l.CE)("span",h,"已付款")):((0,l.uX)(),(0,l.CE)("span",L,"未付款"))],8,k)])]),(0,l.Lk)("td",null,[(0,l.Lk)("div",m,[(0,l.Lk)("button",{class:"btn btn-outline-primary btn-sm",onClick:t=>_.openModal(!1,e)}," 檢視 ",8,g),(0,l.Lk)("button",{class:"btn btn-outline-danger btn-sm",onClick:t=>_.openDelOrderModal(e)}," 刪除 ",8,b)])])],2)):(0,l.Q3)("",!0)],64))),128))])]),(0,l.bF)(f,{order:y.tempOrder,ref:"orderModal",onUpdatePaid:_.updatePaid},null,8,["order","onUpdatePaid"]),(0,l.bF)(O,{item:y.tempOrder,ref:"delModal",onDelItem:_.delOrder},null,8,["item","onDelItem"]),(0,l.bF)(M,{pages:y.pagination,onEmitPages:_.getOrders},null,8,["pages","onEmitPages"])],64)}var y=a(1098);const _={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel",ref:"modal"},C={class:"modal-dialog modal-xl",role:"document"},f={class:"modal-content border-0"},O={class:"modal-header bg-dark text-white"},M={class:"modal-body"},E={class:"row"},X={class:"col-md-4"},P={class:"table"},$={key:0},w={class:"col-md-8"},x={class:"table"},D={key:0},F={key:1},A={key:0,class:"text-success"},I={key:1,class:"text-muted"},K={class:"table"},S={class:"text-end"},U={class:"modal-footer"};function j(e,t,a,s,n,d){return(0,l.uX)(),(0,l.CE)("div",_,[(0,l.Lk)("div",C,[(0,l.Lk)("div",f,[(0,l.Lk)("div",O,[t[3]||(t[3]=(0,l.Lk)("h5",{class:"modal-title",id:"exampleModalLabel"},[(0,l.Lk)("span",null,"訂單細節")],-1)),(0,l.Lk)("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=(...t)=>e.hideModal&&e.hideModal(...t)),"aria-label":"Close"})]),(0,l.Lk)("div",M,[(0,l.Lk)("div",E,[(0,l.Lk)("div",X,[t[8]||(t[8]=(0,l.Lk)("h3",null,"用戶資料",-1)),(0,l.Lk)("table",P,[n.tempOrder.user?((0,l.uX)(),(0,l.CE)("tbody",$,[(0,l.Lk)("tr",null,[t[4]||(t[4]=(0,l.Lk)("th",{style:{width:"100px"}},"姓名",-1)),(0,l.Lk)("td",null,(0,r.v_)(n.tempOrder.user.name),1)]),(0,l.Lk)("tr",null,[t[5]||(t[5]=(0,l.Lk)("th",null,"Email",-1)),(0,l.Lk)("td",null,(0,r.v_)(n.tempOrder.user.email),1)]),(0,l.Lk)("tr",null,[t[6]||(t[6]=(0,l.Lk)("th",null,"電話",-1)),(0,l.Lk)("td",null,(0,r.v_)(n.tempOrder.user.tel),1)]),(0,l.Lk)("tr",null,[t[7]||(t[7]=(0,l.Lk)("th",null,"地址",-1)),(0,l.Lk)("td",null,(0,r.v_)(n.tempOrder.user.address),1)])])):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",w,[t[15]||(t[15]=(0,l.Lk)("h3",null,"訂單細節",-1)),(0,l.Lk)("table",x,[(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[t[9]||(t[9]=(0,l.Lk)("th",{style:{width:"100px"}},"訂單編號",-1)),(0,l.Lk)("td",null,(0,r.v_)(n.tempOrder.id),1)]),(0,l.Lk)("tr",null,[t[10]||(t[10]=(0,l.Lk)("th",null,"下單時間",-1)),(0,l.Lk)("td",null,(0,r.v_)(n.tempOrder.create_at?e.$filters.date(n.tempOrder.create_at):"-"),1)]),(0,l.Lk)("tr",null,[t[11]||(t[11]=(0,l.Lk)("th",null,"付款時間",-1)),(0,l.Lk)("td",null,[n.tempOrder.paid_date?((0,l.uX)(),(0,l.CE)("span",D,(0,r.v_)(e.$filters.date(n.tempOrder.paid_date)),1)):((0,l.uX)(),(0,l.CE)("span",F,"時間不正確"))])]),(0,l.Lk)("tr",null,[t[12]||(t[12]=(0,l.Lk)("th",null,"付款狀態",-1)),(0,l.Lk)("td",null,[n.tempOrder.is_paid?((0,l.uX)(),(0,l.CE)("strong",A,"已付款")):((0,l.uX)(),(0,l.CE)("span",I,"尚未付款"))])]),(0,l.Lk)("tr",null,[t[13]||(t[13]=(0,l.Lk)("th",null,"總金額",-1)),(0,l.Lk)("td",null,(0,r.v_)(n.tempOrder.create_at?d.formatDate(n.tempOrder.create_at):"-"),1)])])]),t[16]||(t[16]=(0,l.Lk)("h3",null,"選購商品",-1)),(0,l.Lk)("table",K,[t[14]||(t[14]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr")],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.tempOrder.products,t=>((0,l.uX)(),(0,l.CE)("tr",{key:t.id},[(0,l.Lk)("th",null,(0,r.v_)(t.product.title),1),(0,l.Lk)("td",null,(0,r.v_)(t.qty)+" / "+(0,r.v_)(t.product.unit),1),(0,l.Lk)("td",S,(0,r.v_)(e.$filters.currency(t.final_total)),1)]))),128))])])])])]),(0,l.Lk)("div",U,[(0,l.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[1]||(t[1]=(...t)=>e.hideModal&&e.hideModal(...t))},"取消 "),(0,l.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[2]||(t[2]=t=>e.$emit("update-order",n.tempOrder))},"確認")])])])],512)}var N={name:"orderModal",props:{order:{type:Object,default(){return{}}}},data(){return{status:{},modal:"",tempOrder:{products:[],user:null},isPaid:!1}},emits:["update-product"],inject:["emitter"],watch:{order(){this.tempOrder={...this.order,products:this.order.products||[],user:this.order.user||null},this.isPaid=this.tempOrder.is_paid}},methods:{formatDate(e){return e?new Date(e).toLocaleString():"-"},formatCurrency(e){return null==e?"-":new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD"}).format(e)}}},Q=a(1241);const V=(0,Q.A)(N,[["render",j]]);var q=V,z=a(7971),T=a(4373),W=a(8704),H={data(){return{orders:[],isNew:!1,pagination:{},isLoading:!1,tempOrder:{},currentPage:1}},components:{Pagination:z.A,DelModal:y.A,OrderModal:q},methods:{async getOrders(e=1){const t=W.A.get("token")||"";if(t)try{const a=`https://vue3-course-api.hexschool.io/api/yusei-api/admin/orders?page=${e}`,l=await T.A.get(a,{headers:{Authorization:t}});console.log(l.data),l.data.success?(this.orders=l.data.orders,this.pagination=l.data.pagination):alert(l.data.message||"取得訂單失敗")}catch(a){console.error(a),alert("網路錯誤，請稍後再試")}else alert("尚未登入，請先登入")},openModal(e,t){this.tempOrder={...t},this.isNew=!1;const a=this.$refs.orderModal;a.showModal()},openDelOrderModal(e){this.tempOrder={...e};const t=this.$refs.delModal;t.showModal()},updatePaid(e){this.isLoading=!0;const t=`https://vue3-course-api.hexschool.io/api/yusei-api/admin/order/${e.id}`,a={is_paid:e.is_paid};this.$http.put(t,{data:a}).then(e=>{this.isLoading=!1,this.getOrders(this.currentPage),this.$httpMessageState(e,"更新付款狀態")})},delOrder(){const e=`https://vue3-course-api.hexschool.io/api/yusei-api/admin/order/${this.tempOrder.id}`;this.isLoading=!0,this.$http.delete(e).then(e=>{console.log(e);const t=this.$refs.delModal;t.hideModal(),this.getOrders(this.currentPage)})},formatDate(e){if(!e)return"-";const t=new Date(1e3*e);return t.toLocaleDateString()}},created(){this.getOrders(),console.log("https://vue3-course-api.hexschool.io/")}};const B=(0,Q.A)(H,[["render",v]]);var G=B},7971:function(e,t,a){a.d(t,{A:function(){return k}});var l=a(6768),r=a(4232),s=a(5130);const n={key:0,"aria-label":"Page navigation example"},d={class:"pagination justify-content-center"},o=["onClick"];function i(e,t,a,i,u,c){return a.pages&&a.pages.total_pages>0?((0,l.uX)(),(0,l.CE)("nav",n,[(0,l.Lk)("ul",d,[(0,l.Lk)("li",{class:(0,r.C4)(["page-item",{disabled:a.pages.current_page<=1}])},[(0,l.Lk)("a",{class:"page-link",href:"#",onClick:t[0]||(t[0]=(0,s.D$)(e=>c.updatePage(a.pages.current_page-1),["prevent"]))}," « ")],2),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.pages.total_pages,e=>((0,l.uX)(),(0,l.CE)("li",{class:(0,r.C4)(["page-item",{active:e===a.pages.current_page}]),key:e},[(0,l.Lk)("a",{class:"page-link",href:"#",onClick:(0,s.D$)(t=>c.updatePage(e),["prevent"])},(0,r.v_)(e),9,o)],2))),128)),(0,l.Lk)("li",{class:(0,r.C4)(["page-item",{disabled:a.pages.current_page>=a.pages.total_pages}])},[(0,l.Lk)("a",{class:"page-link",href:"#",onClick:t[1]||(t[1]=(0,s.D$)(e=>c.updatePage(a.pages.current_page+1),["prevent"]))}," » ")],2)])])):(0,l.Q3)("",!0)}var u={name:"MyPagination",props:["pages"],methods:{updatePage(e){this.$emit("emit-pages",e)}}},c=a(1241);const p=(0,c.A)(u,[["render",i]]);var k=p}}]);
//# sourceMappingURL=339.c530d0cd.js.map